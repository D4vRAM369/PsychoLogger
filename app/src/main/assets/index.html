<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bit√°cora Psicon√°utica</title>
    <style>
        :root {
            --primary-purple: #8B5CF6;
            --secondary-pink: #EC4899;
            --accent-cyan: #06B6D4;
            --accent-orange: #F97316;
            --dark-bg: #0F0F23;
            --darker-bg: #080813;
            --card-bg: #1A1A2E;
            --text-light: #E5E7EB;
            --text-muted: #9CA3AF;
            --border-color: rgba(139, 92, 246, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background: var(--dark-bg) !important;
            min-height: 100vh;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%) !important;
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            margin: 0;
            padding: 0;
        }

        /* Force dark background on WebView */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            z-index: -10;
        }

        /* Animated psychedelic background */
        .psychedelic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -5;
            opacity: 0.2;
            background:
                radial-gradient(circle at 25% 75%, var(--primary-purple) 0%, transparent 40%),
                radial-gradient(circle at 75% 25%, var(--secondary-pink) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, var(--accent-cyan) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, var(--accent-orange) 0%, transparent 35%),
                radial-gradient(circle at 20% 20%, var(--secondary-pink) 0%, transparent 35%);
            animation: psychedelicMove 25s ease-in-out infinite;
        }

        .psychedelic-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                conic-gradient(from 0deg at 30% 70%, transparent 0deg, var(--primary-purple) 60deg, transparent 120deg),
                conic-gradient(from 180deg at 70% 30%, transparent 0deg, var(--accent-cyan) 60deg, transparent 120deg);
            opacity: 0.1;
            animation: psychedelicRotate 30s linear infinite;
        }

        .psychedelic-bg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at 60% 40%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 60%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            animation: psychedelicPulse 20s ease-in-out infinite;
        }

        @keyframes psychedelicMove {
            0%, 100% {
                transform: scale(1) rotate(0deg) translateX(0px) translateY(0px);
                opacity: 0.2;
            }
            25% {
                transform: scale(1.3) rotate(90deg) translateX(20px) translateY(-15px);
                opacity: 0.3;
            }
            50% {
                transform: scale(0.8) rotate(180deg) translateX(-15px) translateY(20px);
                opacity: 0.15;
            }
            75% {
                transform: scale(1.1) rotate(270deg) translateX(-20px) translateY(-10px);
                opacity: 0.25;
            }
        }

        @keyframes psychedelicRotate {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        @keyframes psychedelicPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.2;
            }
        }

        /* Floating molecules */
        .floating-symbols {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -3;
            pointer-events: none;
            overflow: hidden;
        }

        .symbol {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0.1;
            color: var(--primary-purple);
            animation: float 20s ease-in-out infinite;
        }

        .symbol:nth-child(1) {
            top: 10%; left: 15%;
            animation-delay: 0s;
            animation-duration: 25s;
        }
        .symbol:nth-child(2) {
            top: 70%; left: 80%;
            animation-delay: 5s;
            animation-duration: 30s;
            color: var(--secondary-pink);
        }
        .symbol:nth-child(3) {
            top: 30%; left: 70%;
            animation-delay: 10s;
            animation-duration: 35s;
            color: var(--accent-cyan);
        }
        .symbol:nth-child(4) {
            top: 80%; left: 20%;
            animation-delay: 15s;
            animation-duration: 28s;
            color: var(--accent-orange);
        }
        .symbol:nth-child(5) {
            top: 50%; left: 10%;
            animation-delay: 8s;
            animation-duration: 32s;
            color: var(--primary-purple);
        }
        .symbol:nth-child(6) {
            top: 20%; left: 50%;
            animation-delay: 12s;
            animation-duration: 27s;
            color: var(--secondary-pink);
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg) scale(1);
                opacity: 0.1;
            }
            25% {
                transform: translateY(-20px) rotate(90deg) scale(1.2);
                opacity: 0.2;
            }
            50% {
                transform: translateY(15px) rotate(180deg) scale(0.8);
                opacity: 0.15;
            }
            75% {
                transform: translateY(-10px) rotate(270deg) scale(1.1);
                opacity: 0.25;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: transparent;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem 0;
            position: relative;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .mystical-symbol {
            font-size: 3rem;
            opacity: 0.7;
            animation: symbolGlow 4s ease-in-out infinite alternate;
            user-select: none;
        }

        .mystical-symbol.left {
            color: var(--accent-cyan);
            animation-delay: 0s;
        }

        .mystical-symbol.right {
            color: var(--secondary-pink);
            animation-delay: 2s;
        }

        @keyframes symbolGlow {
            0% {
                opacity: 0.7;
                transform: scale(1) rotate(0deg);
                text-shadow: 0 0 10px currentColor;
            }
            100% {
                opacity: 1;
                transform: scale(1.1) rotate(360deg);
                text-shadow: 0 0 20px currentColor, 0 0 30px currentColor;
            }
        }

        .header-title {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-pink), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            animation: colorShift 3s ease-in-out infinite;
        }

        @keyframes colorShift {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(90deg); }
        }

        .header p {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            margin-bottom: 5rem;
        }

        .sidebar {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            height: fit-content;
            backdrop-filter: blur(10px);
        }

        .sidebar h3 {
            margin-bottom: 1rem;
            color: var(--primary-purple);
            font-size: 1.2rem;
        }

        .substance-list {
            list-style: none;
        }

        .substance-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .substance-item:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: var(--primary-purple);
            transform: translateX(5px);
        }

        .substance-item.active {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-pink));
            border-color: var(--accent-cyan);
        }

        .substance-count {
            background: var(--accent-cyan);
            color: var(--dark-bg);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .add-substance-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--accent-orange), var(--secondary-pink));
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .add-substance-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(249, 115, 22, 0.3);
        }

        .calendar-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .calendar-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            background: var(--primary-purple);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover {
            background: var(--secondary-pink);
            transform: scale(1.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: var(--darker-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
        }

        .calendar-day:hover {
            background: rgba(139, 92, 246, 0.2);
        }

        .calendar-day.has-entry {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-pink));
            color: white;
        }

        .calendar-day.has-entry::after {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background: var(--accent-cyan);
            border-radius: 50%;
        }

        .substance-indicators {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 2px;
        }

        .substance-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        /* Color picker styles */
        .color-picker-container {
            margin: 1rem 0;
        }

        .color-options {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: var(--text-light);
        }

        .color-option.selected {
            border-color: var(--accent-cyan);
            transform: scale(1.2);
        }

        .color-option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0,0,0,0.8);
        }

        /* Predefined substance colors */
        .substance-color-1 { background: #8B5CF6; }
        .substance-color-2 { background: #06B6D4; }
        .substance-color-3 { background: #F97316; }
        .substance-color-4 { background: #EF4444; }
        .substance-color-5 { background: #10B981; }
        .substance-color-6 { background: #F59E0B; }
        .substance-color-7 { background: #EC4899; }
        .substance-color-8 { background: #8B5CF6; }
        .substance-color-9 { background: #6366F1; }
        .substance-color-10 { background: #84CC16; }
        .substance-color-11 { background: #F43F5E; }
        .substance-color-12 { background: #06B6D4; }

        /* Dynamic color classes will be added via JavaScript */

        .day-header {
            background: var(--primary-purple);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 1rem;
            backdrop-filter: blur(20px);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 12px;
            min-width: 80px;
        }

        .nav-item:hover {
            background: rgba(139, 92, 246, 0.1);
            transform: translateY(-2px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-pink));
            color: white;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 0.25rem;
        }

        .nav-label {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border-color);
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--text-light);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--primary-purple);
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--darker-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-light);
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-purple), var(--secondary-pink));
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
        }

        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .resource-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
        }

        .resource-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-purple);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.1);
        }

        .resource-card h4 {
            color: var(--accent-cyan);
            margin-bottom: 0.5rem;
        }

        .entry-item {
            background: var(--darker-bg);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .entry-substance {
            color: var(--primary-purple);
            font-weight: 600;
        }

        .entry-time {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .entry-dose {
            color: var(--accent-cyan);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .entry-notes {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header-content {
                gap: 1rem;
            }

            .mystical-symbol {
                font-size: 2rem;
            }

            .calendar-container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
<div class="psychedelic-bg"></div>

<!-- Floating mystical symbols -->
<div class="floating-symbols">
    <div class="symbol">üçÑ</div>
    <div class="symbol">‚öõÔ∏è</div>
    <div class="symbol">üî¨</div>
    <div class="symbol">üëÅÔ∏è</div>
    <div class="symbol">üåÄ</div>
    <div class="symbol">‚ú®</div>
</div>

<div class="container">
    <header class="header">
        <div class="header-content">
            <div class="mystical-symbol left">üëÅÔ∏è</div>
            <div class="header-title">
                <h1>Bit√°cora Psicon√°utica</h1>
                <p>Tu compa√±ero de viaje para un consumo consciente y responsable</p>
            </div>
            <div class="mystical-symbol right">üóùÔ∏è</div>
        </div>
    </header>

    <main id="main-content" class="main-content">
        <!-- Calendar View (Default) -->
        <div id="calendar-view" class="view active">
            <div class="sidebar">
                <h3>Sustancias</h3>
                <ul id="substance-list" class="substance-list">
                    <!-- Se llenar√°n din√°micamente -->
                </ul>
                <button class="add-substance-btn" onclick="openModal('substanceModal')">
                    + A√±adir Sustancia
                </button>
            </div>

            <div class="calendar-container">
                <div class="calendar-header">
                    <h2 id="current-month">Enero 2025</h2>
                    <div class="calendar-nav">
                        <button class="nav-btn" onclick="previousMonth()">‚Äπ</button>
                        <button class="nav-btn" onclick="nextMonth()">‚Ä∫</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar will be generated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Stats View -->
        <div id="stats-view" class="view" style="display: none;">
            <div class="calendar-container">
                <h2>Estad√≠sticas y An√°lisis</h2>
                <div class="resources-grid" id="stats-content">
                    <!-- Se llenar√°n din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Resources View -->
        <div id="resources-view" class="view" style="display: none;">
            <div class="calendar-container">
                <h2>Recursos y Harm Reduction</h2>
                <div class="resources-grid">
                    <a href="https://erowid.org" target="_blank" class="resource-card">
                        <h4>Erowid</h4>
                        <p>Base de datos completa sobre sustancias psicoactivas, experiencias y efectos</p>
                    </a>
                    <a href="https://tripsit.me" target="_blank" class="resource-card">
                        <h4>TripSit</h4>
                        <p>Informaci√≥n sobre interacciones, dosificaci√≥n y asistencia en tiempo real</p>
                    </a>
                    <a href="https://www.drugsforum.com" target="_blank" class="resource-card">
                        <h4>Drugs Forum</h4>
                        <p>Comunidad para discutir experiencias y pr√°cticas de reducci√≥n de riesgos</p>
                    </a>
                    <a href="https://psychonautwiki.org" target="_blank" class="resource-card">
                        <h4>PsychonautWiki</h4>
                        <p>Enciclopedia cient√≠fica de sustancias psicoactivas y sus efectos</p>
                    </a>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
    <div class="nav-container">
        <div class="nav-item active" onclick="switchView('calendar')">
            <div class="nav-icon">üìÖ</div>
            <div class="nav-label">Calendario</div>
        </div>
        <div class="nav-item" onclick="openModal('entryModal')">
            <div class="nav-icon">‚ûï</div>
            <div class="nav-label">A√±adir</div>
        </div>
        <div class="nav-item" onclick="switchView('stats')">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">Stats</div>
        </div>
        <div class="nav-item" onclick="switchView('resources')">
            <div class="nav-icon">üîó</div>
            <div class="nav-label">Recursos</div>
        </div>
    </div>
</nav>

<!-- Add Entry Modal -->
<div id="entryModal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('entryModal')">√ó</button>
        <h3>Nuevo Registro</h3>
        <form id="entryForm">
            <div class="form-group">
                <label>Sustancia</label>
                <select id="entrySubstance">
                    <!-- Se llenar√°n din√°micamente -->
                </select>
            </div>
            <div class="form-group">
                <label>Dosis</label>
                <input type="number" id="entryDose" placeholder="100" step="0.1">
            </div>
            <div class="form-group">
                <label>Unidad</label>
                <select id="entryUnit">
                    <option>Œºg (microgramos)</option>
                    <option>mg (miligramos)</option>
                    <option>g (gramos)</option>
                    <option>Pastilla</option>
                    <option>Tripi</option>
                    <option>Medio tripi</option>
                    <option>Cuarto de tripi</option>
                    <option>Raya</option>
                    <option>Tirito</option>
                </select>
            </div>
            <div class="form-group">
                <label>Fecha y Hora</label>
                <input type="datetime-local" id="entryDateTime">
            </div>
            <div class="form-group">
                <label>Notas</label>
                <textarea id="entryNotes" placeholder="Set, setting, experiencia..."></textarea>
            </div>
            <button type="submit" class="btn-primary">Guardar Registro</button>
        </form>
    </div>
</div>

<!-- Add Substance Modal -->
<div id="substanceModal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('substanceModal')">√ó</button>
        <h3>Nueva Sustancia</h3>
        <form id="substanceForm">
            <div class="form-group">
                <label>Nombre de la Sustancia</label>
                <input type="text" id="substanceName" placeholder="ej: 2C-B, DMT, Ketamina...">
            </div>
            <div class="form-group">
                <label>Color de identificaci√≥n</label>
                <div class="color-picker-container">
                    <div class="color-options" id="colorOptions">
                        <!-- Se llenar√°n din√°micamente -->
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Categor√≠a</label>
                <select id="substanceCategory">
                    <option>Psicod√©lico</option>
                    <option>Estimulante</option>
                    <option>Depresivo</option>
                    <option>Disociativo</option>
                    <option>Ente√≥geno</option>
                </select>
            </div>
            <div class="form-group">
                <label>Unidad de medida principal</label>
                <select id="substanceUnit">
                    <option>Œºg (microgramos)</option>
                    <option>mg (miligramos)</option>
                    <option>g (gramos)</option>
                    <option>Pastilla</option>
                    <option>Tripi</option>
                </select>
            </div>
            <button type="submit" class="btn-primary">A√±adir Sustancia</button>
        </form>
    </div>
</div>

<!-- Day Entry Modal -->
<div id="dayModal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('dayModal')">√ó</button>
        <h3 id="dayModalTitle">D√≠a seleccionado</h3>
        <div id="dayEntries">
            <!-- Se llenar√°n din√°micamente -->
        </div>
    </div>
</div>

<script>
    // State management
    let currentMonth = new Date();
    let currentView = 'calendar';
    let selectedColor = '#8B5CF6'; // Default color

    // Available colors for substances
    const availableColors = [
        '#8B5CF6', '#06B6D4', '#F97316', '#EF4444',
        '#10B981', '#F59E0B', '#EC4899', '#6366F1',
        '#84CC16', '#F43F5E', '#A855F7', '#14B8A6'
    ];

    // Default substances with colors
    const defaultSubstances = {
        lsd: { name: 'LSD', color: '#8B5CF6', entries: {} },
        psilocybin: { name: 'Psilocibina', color: '#06B6D4', entries: {} },
        mdma: { name: 'MDMA', color: '#F97316', entries: {} }
    };

    // Storage functions
    function loadData() {
        try {
            const stored = localStorage.getItem('psycho-logger-data');
            return stored ? JSON.parse(stored) : defaultSubstances;
        } catch (e) {
            console.error('Error loading data:', e);
            return defaultSubstances;
        }
    }

    function saveData(data) {
        try {
            localStorage.setItem('psycho-logger-data', JSON.stringify(data));
        } catch (e) {
            console.error('Error saving data:', e);
        }
    }

    let substanceData = loadData();

    // Generate substance list
    function updateSubstanceList() {
        const list = document.getElementById('substance-list');
        const select = document.getElementById('entrySubstance');

        if (!list || !select) return;

        list.innerHTML = '';
        select.innerHTML = '';

        Object.keys(substanceData).forEach(key => {
            const substance = substanceData[key];
            const count = Object.keys(substance.entries || {}).length;

            // Sidebar item with colored indicator
            const listItem = document.createElement('li');
            listItem.className = 'substance-item';
            listItem.dataset.substance = key;
            listItem.style.setProperty('--substance-color', substance.color);
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <div style="width: 12px; height: 12px; border-radius: 50%; background: ${substance.color};"></div>
                    ${substance.name}
                </div>
                <span class="substance-count">${count}</span>
            `;
            listItem.onclick = () => selectSubstance(key);
            list.appendChild(listItem);

            // Select option
            const option = document.createElement('option');
            option.value = key;
            option.textContent = substance.name;
            select.appendChild(option);
        });

        // Select first substance by default
        if (Object.keys(substanceData).length > 0) {
            selectSubstance(Object.keys(substanceData)[0]);
        }
    }

    // Generate color picker
    function generateColorPicker() {
        const colorOptions = document.getElementById('colorOptions');
        if (!colorOptions) return;

        colorOptions.innerHTML = '';

        availableColors.forEach((color, index) => {
            const colorOption = document.createElement('div');
            colorOption.className = 'color-option';
            colorOption.style.backgroundColor = color;
            colorOption.dataset.color = color;

            if (color === selectedColor) {
                colorOption.classList.add('selected');
            }

            colorOption.onclick = () => {
                // Remove previous selection
                document.querySelectorAll('.color-option').forEach(opt =>
                    opt.classList.remove('selected'));

                // Add selection to clicked option
                colorOption.classList.add('selected');
                selectedColor = color;
            };

            colorOptions.appendChild(colorOption);
        });
    }

    function selectSubstance(substanceKey) {
        document.querySelectorAll('.substance-item').forEach(item =>
            item.classList.remove('active'));
        const activeItem = document.querySelector(`[data-substance="${substanceKey}"]`);
        if (activeItem) {
            activeItem.classList.add('active');
        }
        generateCalendar();
    }

    // Generate calendar
    function generateCalendar() {
        const grid = document.getElementById('calendar-grid');
        const monthYear = document.getElementById('current-month');

        if (!grid || !monthYear) return;

        grid.innerHTML = '';

        const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        monthYear.textContent = `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;

        // Day headers
        const dayHeaders = ['L', 'M', 'X', 'J', 'V', 'S', 'D'];
        dayHeaders.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day day-header';
            dayHeader.textContent = day;
            grid.appendChild(dayHeader);
        });

        // Calendar days
        const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - (firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1));

        for(let i = 0; i < 42; i++) {
            const date = new Date(startDate);
            date.setDate(startDate.getDate() + i);

            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = date.getDate();

            const dateString = date.toISOString().split('T')[0];

            // Check for entries on this date
            const dayEntries = [];
            Object.keys(substanceData).forEach(substanceKey => {
                const substance = substanceData[substanceKey];
                if (substance.entries && substance.entries[dateString]) {
                    substance.entries[dateString].forEach(entry => {
                        dayEntries.push({
                            ...entry,
                            substance: substanceKey,
                            substanceName: substance.name,
                            color: substance.color
                        });
                    });
                }
            });

            if (dayEntries.length > 0) {
                dayElement.classList.add('has-entry');

                // Add substance indicators
                const indicators = document.createElement('div');
                indicators.className = 'substance-indicators';

                const uniqueSubstances = [...new Set(dayEntries.map(e => e.substance))];
                uniqueSubstances.forEach(substanceKey => {
                    const dot = document.createElement('div');
                    dot.className = 'substance-dot';
                    dot.style.backgroundColor = substanceData[substanceKey].color;
                    indicators.appendChild(dot);
                });

                dayElement.appendChild(indicators);
            }

            if(date.getMonth() !== currentMonth.getMonth()) {
                dayElement.style.opacity = '0.3';
            }

            dayElement.onclick = () => openDayModal(date, dayEntries);
            grid.appendChild(dayElement);
        }
    }

    // Navigation functions
    function previousMonth() {
        currentMonth.setMonth(currentMonth.getMonth() - 1);
        generateCalendar();
    }

    function nextMonth() {
        currentMonth.setMonth(currentMonth.getMonth() + 1);
        generateCalendar();
    }

    function switchView(view) {
        // Update nav items
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        if (event && event.target) {
            const navItem = event.target.closest('.nav-item');
            if (navItem) navItem.classList.add('active');
        }

        // Hide all views
        document.querySelectorAll('.view').forEach(viewEl => viewEl.style.display = 'none');

        // Show selected view
        const viewElement = document.getElementById(view + '-view');
        if (viewElement) {
            viewElement.style.display = 'block';
        }

        if (view === 'stats') {
            updateStats();
        }

        currentView = view;
    }

    // Modal functions
    function openModal(modalId) {
        if (modalId === 'entryModal') {
            // Set current date/time
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            const dateTimeInput = document.getElementById('entryDateTime');
            if (dateTimeInput) {
                dateTimeInput.value = now.toISOString().slice(0, 16);
            }
        } else if (modalId === 'substanceModal') {
            // Reset color selection and generate color picker
            selectedColor = availableColors[0];
            generateColorPicker();
        }

        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
        }
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
        }
    }

    function openDayModal(date, entries) {
        const modal = document.getElementById('dayModal');
        const title = document.getElementById('dayModalTitle');
        const content = document.getElementById('dayEntries');

        if (!modal || !title || !content) return;

        title.textContent = date.toLocaleDateString('es-ES', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        if(entries && entries.length > 0) {
            content.innerHTML = entries.map(entry => `
                <div class="entry-item">
                    <div class="entry-header">
                        <span class="entry-substance">${entry.substanceName}</span>
                        <span class="entry-time">${entry.time}</span>
                    </div>
                    <div class="entry-dose"><strong>Dosis:</strong> ${entry.dose} ${entry.unit}</div>
                    ${entry.notes ? `<div class="entry-notes">${entry.notes}</div>` : ''}
                </div>
            `).join('');
        } else {
            content.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No hay registros para este d√≠a</p>';
        }

        modal.classList.add('active');
    }

    // Form handlers
    function initFormHandlers() {
        const entryForm = document.getElementById('entryForm');
        if (entryForm) {
            entryForm.onsubmit = function(e) {
                e.preventDefault();

                const substance = document.getElementById('entrySubstance').value;
                const dose = document.getElementById('entryDose').value;
                const unit = document.getElementById('entryUnit').value;
                const dateTimeValue = document.getElementById('entryDateTime').value;
                const notes = document.getElementById('entryNotes').value;

                if (!substance || !dose || !dateTimeValue) {
                    alert('Por favor completa todos los campos obligatorios');
                    return;
                }

                const dateTime = new Date(dateTimeValue);
                const dateString = dateTime.toISOString().split('T')[0];
                const timeString = dateTime.toTimeString().slice(0, 5);

                // Initialize entries array if doesn't exist
                if (!substanceData[substance].entries) {
                    substanceData[substance].entries = {};
                }
                if (!substanceData[substance].entries[dateString]) {
                    substanceData[substance].entries[dateString] = [];
                }

                // Add new entry
                substanceData[substance].entries[dateString].push({
                    time: timeString,
                    dose: dose,
                    unit: unit,
                    notes: notes
                });

                // Save to localStorage
                saveData(substanceData);

                // Update UI
                updateSubstanceList();
                generateCalendar();
                updateStats();

                // Clear form and close modal
                entryForm.reset();
                closeModal('entryModal');
            };
        }

        const substanceForm = document.getElementById('substanceForm');
        if (substanceForm) {
            substanceForm.onsubmit = function(e) {
                e.preventDefault();

                const name = document.getElementById('substanceName').value;
                const category = document.getElementById('substanceCategory').value;
                const unit = document.getElementById('substanceUnit').value;

                if (!name) {
                    alert('Por favor ingresa el nombre de la sustancia');
                    return;
                }

                // Generate key from name
                const key = name.toLowerCase().replace(/[^a-z0-9]/g, '');

                // Check if already exists
                if (substanceData[key]) {
                    alert('Esta sustancia ya existe');
                    return;
                }

                // Add new substance with selected color
                substanceData[key] = {
                    name: name,
                    category: category,
                    unit: unit,
                    color: selectedColor,
                    entries: {}
                };

                // Save to localStorage
                saveData(substanceData);

                // Update UI
                updateSubstanceList();
                generateCalendar();

                // Clear form and close modal
                substanceForm.reset();
                closeModal('substanceModal');
            };
        }
    }

    // Stats update function
    function updateStats() {
        const statsContent = document.getElementById('stats-content');
        if (!statsContent) return;

        // Calculate stats
        const totalEntries = Object.values(substanceData).reduce((total, substance) =>
            total + Object.keys(substance.entries || {}).length, 0);

        const mostUsed = Object.entries(substanceData).reduce((max, [key, substance]) => {
            const count = Object.keys(substance.entries || {}).length;
            return count > max.count ? { name: substance.name, count } : max;
        }, { name: 'Ninguna', count: 0 });

        // Get recent usage
        const recentEntries = [];
        Object.entries(substanceData).forEach(([key, substance]) => {
            if (substance.entries) {
                Object.entries(substance.entries).forEach(([date, entries]) => {
                    entries.forEach(entry => {
                        recentEntries.push({
                            date: new Date(date),
                            substance: substance.name,
                            ...entry
                        });
                    });
                });
            }
        });

        recentEntries.sort((a, b) => b.date - a.date);
        const lastEntry = recentEntries[0];
        const daysSinceLastUse = lastEntry ?
            Math.floor((new Date() - lastEntry.date) / (1000 * 60 * 60 * 24)) : 0;

        statsContent.innerHTML = `
            <div class="resource-card">
                <h4>Frecuencia de Uso</h4>
                <p><strong>Total de registros:</strong> ${totalEntries}</p>
                <p><strong>Sustancia m√°s usada:</strong> ${mostUsed.name} (${mostUsed.count} veces)</p>
                <p><strong>√öltima vez:</strong> ${lastEntry ? `hace ${daysSinceLastUse} d√≠as` : 'Sin registros'}</p>
            </div>
            <div class="resource-card">
                <h4>Patrones</h4>
                <p><strong>Promedio mensual:</strong> ${(totalEntries / 3).toFixed(1)} usos</p>
                <p><strong>Sustancias registradas:</strong> ${Object.keys(substanceData).length}</p>
            </div>
            <div class="resource-card">
                <h4>Recomendaciones</h4>
                <p><strong>Espaciado recomendado:</strong> 7-14 d√≠as entre usos</p>
                <p><strong>Recuerda:</strong> La moderaci√≥n es clave para un uso responsable</p>
            </div>
        `;
    }

    // Close modals when clicking outside
    function initModalCloseHandlers() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.onclick = (e) => {
                if(e.target === modal) {
                    modal.classList.remove('active');
                }
            };
        });
    }

    // Initialize app
    function initApp() {
        updateSubstanceList();
        generateCalendar();
        updateStats();
        initFormHandlers();
        initModalCloseHandlers();
        generateColorPicker();  
    }

    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initApp);
    } else {
        initApp();
    }
</script>
</body>
</html>